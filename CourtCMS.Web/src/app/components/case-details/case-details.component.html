<div class="case-details-container">
  <!-- Loading State -->
  @if (isLoading) {
    <div class="loading">
      <p>Loading case details...</p>
    </div>
  }

  <!-- Error State -->
  @else if (errorMessage) {
    <div class="error-message">
      <p>{{ errorMessage }}</p>
      <button routerLink="/" class="btn-back">← Back to Case List</button>
    </div>
  }

  <!-- Success: Display Case Details -->
  @else if (caseData) {
    <div class="details-header">
      <h1>{{ caseData.caseNumber }}</h1>
      <span class="status-badge" [class.closed]="caseData.status === 'Closed'">
        {{ caseData.status }}
      </span>
    </div>

    <h2>{{ caseData.title }}</h2>

    <!-- Case Information Grid -->
    <div class="info-grid">
      <div class="info-item">
        <strong>Filed:</strong>
        {{ caseData.filingDate | date: 'mediumDate' }}
      </div>
      <div class="info-item">
        <strong>Assigned Judge:</strong>
        {{ caseData.assignedJudgeName }}
      </div>
      <div class="info-item">
        <strong>Created:</strong>
        {{ caseData.createdDate | date: 'short' }}
      </div>
      @if (caseData.lastModifiedDate) {
        <div class="info-item">
          <strong>Last Modified:</strong>
          {{ caseData.lastModifiedDate | date: 'short' }}
        </div>
      }
    </div>

    <!-- Parties Section -->
    <section class="section">
      <div class="section-header">
        <h3>Parties Involved</h3>
        <button class="btn-add" (click)="openAddPartyModal()">+ Add Party</button>
      </div>

      @if (caseData.parties.length > 0) {
        <ul class="parties-list">
          @for (party of caseData.parties; track party.partyId) {
            <li>
              <div class="party-info">
                <strong>{{ party.fullName }}</strong>
                <span class="role-badge">{{ party.role }}</span>
              </div>
              <button
                class="btn-remove"
                (click)="removePartyFromCase(party.partyId, party.fullName)"
                title="Remove from case"
              >
                ✕
              </button>
            </li>
          }
        </ul>
      } @else {
        <p class="empty-message">No parties assigned to this case.</p>
      }
    </section>

    <!-- Hearings Section -->
    <section class="section">
      <div class="section-header">
        <h3>Scheduled Hearings</h3>
        <button class="btn-add" (click)="openAddHearingModal()">+ Add Hearing</button>
      </div>

      @if (caseData.hearings.length > 0) {
        <div class="hearings-grid">
          @for (hearing of caseData.hearings; track hearing.id) {
            <div class="hearing-card">
              <div class="hearing-card-header">
                <h4>{{ hearing.description }}</h4>
                <div class="hearing-actions">
                  <button
                    class="btn-hearing-edit"
                    (click)="openEditHearingModal(hearing)"
                    title="Edit Hearing"
                  >
                    ✎
                  </button>
                  <button
                    class="btn-hearing-delete"
                    (click)="deleteHearing(hearing)"
                    title="Delete Hearing"
                  >
                    ✕
                  </button>
                </div>
              </div>
              <p>
                <strong>Date:</strong>
                {{ hearing.hearingDate | date: 'full' }}
              </p>
              <p>
                <strong>Location:</strong>
                {{ hearing.location }}
              </p>
            </div>
          }
        </div>
      } @else {
        <p class="empty-message">No hearings scheduled.</p>
      }
    </section>

    <!-- Back Button -->
    <div class="actions">
      <button routerLink="/" class="btn-back">← Back to Case List</button>
    </div>

    <!-- Modals -->
    <app-hearing-form-modal
      [isOpen]="isHearingModalOpen"
      [hearing]="selectedHearing"
      (closeModal)="closeHearingModal()"
      (save)="onHearingSave($event)"
    />

    <app-case-party-modal
      [isOpen]="isPartyModalOpen"
      [availableParties]="allParties"
      [existingParties]="caseData.parties"
      (closeModal)="closePartyModal()"
      (save)="onCasePartySave($event)"
    />
  }
</div>
