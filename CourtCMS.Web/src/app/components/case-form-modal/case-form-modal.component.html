@if (isOpen) {
  <div class="modal-backdrop" (click)="onClose()">
    <div class="modal-container" (click)="onModalClick($event)">
      <!-- HEADER -->
      <div class="modal-header">
        <h3>{{ isEditMode ? 'Edit Case' : 'File New Case' }}</h3>
        <button class="btn-close-x" (click)="onClose()" aria-label="Close modal">&times;</button>
      </div>

      <!-- BODY -->
      <div class="modal-body">
        <form [formGroup]="caseForm" (ngSubmit)="onSubmit()" id="caseForm">
          <fieldset [disabled]="isSaving">
            <!-- CASE NUMBER -->
            <div class="form-group">
              <label for="caseNumber">Case Number</label>
              <input
                type="text"
                id="caseNumber"
                formControlName="caseNumber"
                placeholder="e.g. 2024-CIV-999"
                [class.invalid]="showError('caseNumber')"
              />
              @if (showError('caseNumber')) {
                <span class="error-message">
                  @if (caseForm.get('caseNumber')?.errors?.['required']) {
                    Case number is required.
                  } @else if (caseForm.get('caseNumber')?.errors?.['pattern']) {
                    Must follow format: YYYY-TYPE-### (e.g. 2024-CIV-001).
                  }
                </span>
              }
            </div>

            <!-- TITLE -->
            <div class="form-group">
              <label for="title">Title</label>
              <input
                type="text"
                id="title"
                formControlName="title"
                placeholder="e.g. State vs. Jones"
                [class.invalid]="showError('title')"
              />
              @if (showError('title')) {
                <span class="error-message">
                  @if (caseForm.get('title')?.errors?.['required']) {
                    Case title is required.
                  } @else if (caseForm.get('title')?.errors?.['minlength']) {
                    Case title must be at least 5 characters long.
                  }
                </span>
              }
            </div>

            <!-- ASSIGNED JUDGE -->
            <div class="form-group">
              <label for="assignedJudgeId">Assigned Judge</label>
              <select
                id="assignedJudgeId"
                formControlName="assignedJudgeId"
                [class.invalid]="showError('assignedJudgeId')"
              >
                <option [ngValue]="null" disabled>-- Select a Judge --</option>
                @for (judge of judges; track judge.id) {
                  <option [ngValue]="judge.id">{{ judge.fullName }}</option>
                }
              </select>
              @if (showError('assignedJudgeId')) {
                <span class="error-message">A judge must be assigned to this case.</span>
              }
            </div>

            @if (caseForm.get('status')) {
              <div class="form-group">
                <label for="status">Status</label>
                <select id="status" formControlName="status" [class.invalid]="showError('status')">
                  @for (stat of statuses; track stat) {
                    <option [value]="stat">{{ stat }}</option>
                  }
                </select>
                @if (showError('status')) {
                  <span class="error-message">Status is required.</span>
                }
              </div>
            }
          </fieldset>
        </form>
      </div>

      <!-- FOOTER -->
      <div class="modal-footer">
        <button class="btn-cancel" type="button" (click)="onClose()">Cancel</button>
        <button class="btn-save" type="submit" form="caseForm" [disabled]="isSubmitDisabled">
          {{ isSaving ? 'Saving...' : isEditMode ? 'Update Case' : 'File Case' }}
        </button>
      </div>
    </div>
  </div>
}
